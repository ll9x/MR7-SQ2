<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Danger Square Game</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            background-color: #282c34;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            flex-direction: column;
        }
        .screen {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 800px;
            padding: 20px;
        }
        #welcome-screen {
            display: flex;
        }
        #game-title {
            font-size: 32px;
            margin-bottom: 20px;
        }
        #welcome-image {
            width: 200px;
            height: auto;
            margin-bottom: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.2s;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }
        input {
            padding: 10px;
            margin: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        #board, #game-board {
            display: grid;
            gap: 10px;
            justify-content: center;
            margin: 20px auto;
        }
        #board div, #game-board div {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background-color: #007bff;
            border-radius: 10px;
            transition: background-color 0.3s, transform 0.2s;
        }
        #board div:hover, #game-board div:hover {
            transform: scale(1.1);
        }
        #board div.selected {
            background-color: red !important;
        }
        #game-board div.clicked {
            background-color: green !important;
            pointer-events: none;
        }
        #game-board div.danger {
            background-color: #007bff;
        }
        #game-board div.lost {
            background-color: red !important;
            animation: pulse 1s infinite alternate;
        }
        
        @keyframes pulse {
            0% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        .message {
            font-size: 24px;
            margin: 20px 0;
            font-weight: bold;
        }
        .success {
            color: #28a745;
        }
        .error {
            color: #dc3545;
        }
        #players-list {
            margin: 20px 0;
            text-align: left;
        }
        
        /* Enhanced Players List Styles */
        .players-container {
            background-color: #333;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            max-width: 400px;
        }
        
        .players-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            color: #fff;
        }
        
        .player-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 8px;
            background-color: #444;
            transition: all 0.3s ease;
        }
        
        .player-item.active {
            background-color: #28a745;
            color: white;
        }
        
        .player-item.eliminated {
            background-color: #dc3545;
            color: white;
            opacity: 0.8;
        }
        
        .player-item.winner {
            background-color: #28a745;
            color: white;
            box-shadow: 0 0 15px rgba(40, 167, 69, 0.5);
            animation: winnerGlow 2s infinite alternate;
        }
        
        .player-item.current-turn {
            border: 3px solid #ffc107;
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
            animation: currentTurnPulse 1.5s infinite;
        }
        
        @keyframes winnerGlow {
            0% { box-shadow: 0 0 15px rgba(40, 167, 69, 0.5); }
            100% { box-shadow: 0 0 25px rgba(40, 167, 69, 0.8); }
        }
        
        @keyframes currentTurnPulse {
            0% { border-color: #ffc107; }
            50% { border-color: #ffed4e; }
            100% { border-color: #ffc107; }
        }
        
        @keyframes dangerPulse {
            0% { 
                box-shadow: 0 0 20px rgba(220, 53, 69, 0.8);
                transform: scale(1.1);
            }
            100% { 
                box-shadow: 0 0 30px rgba(220, 53, 69, 1);
                transform: scale(1.15);
            }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .player-status {
            margin-left: auto;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .turn-indicator {
            margin-right: 8px;
            font-size: 16px;
        }
        
        .elimination-order {
            font-size: 11px;
            opacity: 0.8;
            margin-left: 5px;
        }
        #room-id-display {
            font-size: 20px;
            margin: 10px 0;
            padding: 10px;
            background-color: #444;
            border-radius: 5px;
        }
        #copy-room-id {
            background-color: #6c757d;
        }
    </style>
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcome-screen" class="screen">
        <h1 id="game-title">Online Danger Square Game</h1>
        <h1 id="game-title">BY: Mostafa Alrawi</h1>
        <p>Welcome to the Online Danger Square Game!</p>
        <button id="create-room-btn">Create Room</button>
        <button id="join-room-btn">Join Room</button>
    </div>

    <!-- Create Room Screen -->
    <div id="create-room-screen" class="screen">
        <h2>Create Game Room</h2>
        <div>
            <label for="host-name">Your Name:</label>
            <input type="text" id="host-name" placeholder="Enter your name">
        </div>
        <div>
            <label for="create-board-size">Number of Squares:</label>
            <input type="number" id="create-board-size" min="2" max="25" value="9">
        </div>
        <div>
            <label for="max-players">Max Players:</label>
            <input type="number" id="max-players" min="2" max="10" value="4">
        </div>
        <button id="create-room-confirm">Create Room</button>
        <button id="back-to-welcome-from-create">Back</button>
    </div>

    <!-- Join Room Screen -->
    <div id="join-room-screen" class="screen">
        <h2>Join Game Room</h2>
        <div>
            <label for="player-name">Your Name:</label>
            <input type="text" id="player-name" placeholder="Enter your name">
        </div>
        <div>
            <label for="room-id">Room ID:</label>
            <input type="text" id="room-id" placeholder="Enter room ID">
        </div>
        <button id="join-room-confirm">Join Room</button>
        <button id="back-to-welcome-from-join">Back</button>
    </div>

    <!-- Lobby Screen -->
    <div id="lobby-screen" class="screen">
        <h2>Game Lobby</h2>
        <div id="room-id-display">Room ID: <span id="room-id-text"></span> 
            <button id="copy-room-id">Copy</button>
        </div>
        <div id="players-list">
            <h3>Players:</h3>
            <ul id="players-ul"></ul>
        </div>
        <div id="lobby-message" class="message"></div>
        <button id="start-game-btn" style="display: none;">Start Game</button>
        <button id="leave-lobby-btn">Leave Lobby</button>
    </div>



    <!-- This screen is no longer used as danger square is selected randomly -->
    <div id="danger-square-screen" class="screen" style="display: none;">
        <h2>Select Danger Square</h2>
        <p>Click on a square to select it as the danger square</p>
        <div id="board"></div>
        <button id="confirm-danger-square">Confirm Selection</button>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="screen">
        <h2>Danger Square Game</h2>
        <div id="game-info">
            <p>Click the squares, avoid the danger square!</p>
            <p id="current-player"></p>
            <p id="clicked-count"></p>
        </div>
        
        <!-- Enhanced Players List -->
        <div class="players-container">
            <div class="players-title">Players Status</div>
            <div id="game-players-list"></div>
        </div>
        
        <div id="game-board"></div>
        <div id="game-message" class="message"></div>
        <button id="restart-game-btn" style="display: none;">Play Again</button>
        <button id="leave-game-btn">Leave Game</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/game.js"></script>
    <script>
        // DOM Elements
        const screens = document.querySelectorAll('.screen');
        const welcomeScreen = document.getElementById('welcome-screen');
        const createRoomScreen = document.getElementById('create-room-screen');
        const joinRoomScreen = document.getElementById('join-room-screen');
        const lobbyScreen = document.getElementById('lobby-screen');
        const dangerSquareScreen = document.getElementById('danger-square-screen');
        const gameScreen = document.getElementById('game-screen');

        // Buttons
        const createRoomBtn = document.getElementById('create-room-btn');
        const joinRoomBtn = document.getElementById('join-room-btn');
        const createRoomConfirmBtn = document.getElementById('create-room-confirm');
        const joinRoomConfirmBtn = document.getElementById('join-room-confirm');
        const backToWelcomeFromCreateBtn = document.getElementById('back-to-welcome-from-create');
        const backToWelcomeFromJoinBtn = document.getElementById('back-to-welcome-from-join');
        const startGameBtn = document.getElementById('start-game-btn');
        const leaveLobbyBtn = document.getElementById('leave-lobby-btn');
        const confirmDangerSquareBtn = document.getElementById('confirm-danger-square');
        const restartGameBtn = document.getElementById('restart-game-btn');
        const leaveGameBtn = document.getElementById('leave-game-btn');
        const copyRoomIdBtn = document.getElementById('copy-room-id');

        // Inputs
        const hostNameInput = document.getElementById('host-name');
        const playerNameInput = document.getElementById('player-name');
        const roomIdInput = document.getElementById('room-id');

        // Display elements
        const roomIdText = document.getElementById('room-id-text');
        const playersUl = document.getElementById('players-ul');
        const lobbyMessage = document.getElementById('lobby-message');
        const gameMessage = document.getElementById('game-message');
        const currentPlayer = document.getElementById('current-player');
        const clickedCount = document.getElementById('clicked-count');
        const gamePlayersList = document.getElementById('game-players-list');

        // Game elements
        const board = document.getElementById('board');
        const gameBoard = document.getElementById('game-board');

        // Socket.io connection
        const socket = io();
        let roomId = '';
        let isHost = false;
        let playerName = '';
        let boardSize = 9;
        let dangerSquareIndex = -1;
        let currentTurnPlayerId = '';
        let allPlayers = [];
        let activePlayers = [];
        let eliminatedPlayers = [];

        // Switch between screens
        function showScreen(screen) {
            screens.forEach(s => s.style.display = 'none');
            screen.style.display = 'flex';
        }

        // Event listeners
        createRoomBtn.addEventListener('click', () => showScreen(createRoomScreen));
        joinRoomBtn.addEventListener('click', () => showScreen(joinRoomScreen));
        
        backToWelcomeFromCreateBtn.addEventListener('click', () => showScreen(welcomeScreen));
        backToWelcomeFromJoinBtn.addEventListener('click', () => showScreen(welcomeScreen));
        
        leaveLobbyBtn.addEventListener('click', () => {
            socket.emit('leaveRoom');
            showScreen(welcomeScreen);
        });
        
        leaveGameBtn.addEventListener('click', () => {
            socket.emit('leaveRoom');
            showScreen(welcomeScreen);
        });

        copyRoomIdBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(roomIdText.textContent);
            alert('Room ID copied to clipboard!');
        });

        createRoomConfirmBtn.addEventListener('click', () => {
            const name = hostNameInput.value.trim();
            const size = parseInt(document.getElementById('create-board-size').value);
            const maxPlayers = parseInt(document.getElementById('max-players').value);
            
            if (!name) {
                alert('Please enter your name');
                return;
            }
            
            if (isNaN(size) || size < 2 || size > 25) {
                alert('Please enter a valid number of squares between 2 and 25');
                return;
            }
            
            if (isNaN(maxPlayers) || maxPlayers < 2 || maxPlayers > 10) {
                alert('Please enter a valid number of players between 2 and 10');
                return;
            }
            
            playerName = name;
            isHost = true;
            boardSize = size;
            socket.emit('createRoom', { playerName: name, boardSize: size, maxPlayers: maxPlayers });
        });

        joinRoomConfirmBtn.addEventListener('click', () => {
            const name = playerNameInput.value.trim();
            const room = roomIdInput.value.trim().toUpperCase();
            
            if (!name || !room) {
                alert('Please enter both your name and room ID');
                return;
            }
            
            // Validate room ID format (should be 6 characters)
            if (room.length !== 6) {
                alert('Room ID should be exactly 6 characters');
                return;
            }
            
            console.log(`Attempting to join room: ${room}`);
            playerName = name;
            socket.emit('joinRoom', { 
                roomId: room, 
                playerName: name 
            });
        });

        startGameBtn.addEventListener('click', () => {
            // Skip board size selection since it's already set during room creation
            socket.emit('startGame', { boardSize: boardSize });
        });



        // This is no longer needed as danger square is selected randomly
        confirmDangerSquareBtn.addEventListener('click', () => {
            // Keeping this for backward compatibility
        });

        restartGameBtn.addEventListener('click', () => {
            socket.emit('restartGame');
        });

        // Socket.io event handlers
        socket.on('roomCreated', (data) => {
            roomId = data.roomId;
            roomIdText.textContent = roomId;
            updatePlayersList([{ id: socket.id, name: playerName }]);
            lobbyMessage.textContent = 'Room created! Share the code with others to join.';
            startGameBtn.style.display = isHost ? 'block' : 'none';
            boardSize = data.boardSize;
            showScreen(lobbyScreen);
        });

        socket.on('error', (data) => {
            console.error('Server error:', data.message);
            alert(`ÿÆÿ∑ÿ£: ${data.message}\n\nÿ™ÿ£ŸÉÿØ ŸÖŸÜ:\n- ÿµÿ≠ÿ© Room ID\n- ÿ£ŸÜ ÿßŸÑÿ∫ÿ±ŸÅÿ© ŸÑŸÖ ÿ™ÿ®ÿØÿ£ ÿßŸÑŸÑÿπÿ® ÿ®ÿπÿØ\n- ÿ£ŸÜ ÿßŸÑÿ∫ÿ±ŸÅÿ© ŸÑŸäÿ≥ÿ™ ŸÖŸÖÿ™ŸÑÿ¶ÿ©`);
        });

        socket.on('joinedRoom', (data) => {
            console.log('Successfully joined room:', data.roomId);
            roomId = data.roomId;
            roomIdText.textContent = roomId;
            updatePlayersList(data.players);
            lobbyMessage.textContent = `ÿ™ŸÖ ÿßŸÑÿßŸÜÿ∂ŸÖÿßŸÖ ÿ®ŸÜÿ¨ÿßÿ≠ ÿ•ŸÑŸâ ÿßŸÑÿ∫ÿ±ŸÅÿ©: ${roomId}`;
            startGameBtn.style.display = 'none'; // Only host can start
            showScreen(lobbyScreen);
        });

        socket.on('playerJoined', (data) => {
            updatePlayersList(data.players);
            lobbyMessage.textContent = `${data.playerName} joined the room!`;
        });

        socket.on('playerLeft', (data) => {
            updatePlayersList(data.players);
        });

        socket.on('newHost', (data) => {
            isHost = socket.id === data.hostId;
            startGameBtn.style.display = isHost ? 'block' : 'none';
            if (isHost) {
                lobbyMessage.textContent = 'You are now the host. You can start the game.';
            }
        });

        socket.on('gameStarted', (data) => {
            boardSize = data.boardSize;
            createGameBoard(gameBoard, data.boardSize);
            currentTurnPlayerId = data.currentPlayerId;
            
            // Store player data
            allPlayers = data.players || [];
            activePlayers = data.activePlayers || [];
            eliminatedPlayers = data.eliminatedPlayers || [];
            
            // Update players list
            updateGamePlayersList(activePlayers, eliminatedPlayers, currentTurnPlayerId);
            
            if (currentTurnPlayerId === socket.id) {
                currentPlayer.textContent = `Your turn, ${playerName}!`;
            } else {
                currentPlayer.textContent = `${data.currentPlayerName}'s turn`;
            }
            
            showScreen(gameScreen);
        });

        // This event is no longer needed as danger square is selected randomly
        socket.on('dangerSquareSelected', (data) => {
            // Keeping this for backward compatibility
        });

        socket.on('squareClicked', (data) => {
            const square = gameBoard.children[data.squareIndex];
            square.classList.add('clicked');
            clickedCount.textContent = `Squares clicked: ${data.clickedCount}/${boardSize-1}`;
            
            // Update whose turn it is
            currentTurnPlayerId = data.nextPlayerId;
            
            // Update players list
            updateGamePlayersList(activePlayers, eliminatedPlayers, currentTurnPlayerId);
            
            if (currentTurnPlayerId === socket.id) {
                currentPlayer.textContent = `Your turn, ${playerName}!`;
            } else {
                currentPlayer.textContent = `${data.nextPlayerName}'s turn`;
            }
        });

        socket.on('playerEliminated', (data) => {
            const square = gameBoard.children[data.squareIndex];
            
            // Make the danger square visible to ALL players with enhanced effects
            square.classList.add('lost');
            square.style.backgroundColor = '#dc3545'; // Bright red
            square.style.border = '3px solid #721c24'; // Dark red border
            square.style.boxShadow = '0 0 20px rgba(220, 53, 69, 0.8)'; // Red glow
            square.style.transform = 'scale(1.1)'; // Slightly larger
            square.innerHTML = 'üíÄ'; // Skull emoji to indicate danger
            square.style.fontSize = '24px';
            square.style.color = 'white';
            square.style.fontWeight = 'bold';
            
            // Add pulsing animation
            square.style.animation = 'dangerPulse 1s infinite alternate';
            
            // Add screen shake effect for dramatic impact
            document.body.style.animation = 'shake 0.5s';
            setTimeout(() => {
                document.body.style.animation = '';
            }, 500);
            
            // Try to play alert sound (if browser allows)
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmYdBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU5k9n1unEiBC13yO/eizEIHWq+8+OWT');
                audio.volume = 0.3;
                audio.play().catch(() => {});
            } catch (e) {}
            
            // Update game data
            activePlayers = data.activePlayers || [];
            eliminatedPlayers = data.eliminatedPlayers || [];
            currentTurnPlayerId = data.nextPlayerId;
            
            // Update players list
            updateGamePlayersList(activePlayers, eliminatedPlayers, currentTurnPlayerId);
            
            if (socket.id === data.eliminatedId) {
                gameMessage.textContent = 'You hit the danger square! You are eliminated!';
                gameMessage.className = 'message error';
            } else {
                gameMessage.textContent = `${data.eliminatedName} hit the danger square and was eliminated! ${data.remainingPlayers} players remaining.`;
                gameMessage.className = 'message error';
            }
            
            if (currentTurnPlayerId === socket.id) {
                currentPlayer.textContent = `Your turn, ${playerName}!`;
            } else {
                currentPlayer.textContent = `${data.nextPlayerName}'s turn`;
            }
        });

        socket.on('gameWon', (data) => {
            // Update game data with final results
            if (data.eliminatedPlayers) {
                eliminatedPlayers = data.eliminatedPlayers;
            }
            if (data.lastPlayerStanding) {
                activePlayers = [data.winner];
            }
            
            // Show final players list with winner highlighted
            updateGamePlayersList(activePlayers, eliminatedPlayers, '', data.winner);
            
            if (data.loser) {
                // Someone won because they were the last player standing
                // Find and highlight the danger square for ALL players
                const dangerSquareIndex = data.squareIndex || eliminatedPlayers[eliminatedPlayers.length - 1]?.squareIndex;
                if (dangerSquareIndex !== undefined) {
                    const square = gameBoard.children[dangerSquareIndex];
                    if (square) {
                        // Make the danger square visible to ALL players with enhanced effects
                        square.classList.add('lost');
                        square.style.backgroundColor = '#dc3545'; // Bright red
                        square.style.border = '3px solid #721c24'; // Dark red border
                        square.style.boxShadow = '0 0 20px rgba(220, 53, 69, 0.8)'; // Red glow
                        square.style.transform = 'scale(1.1)'; // Slightly larger
                        square.innerHTML = 'üíÄ'; // Skull emoji to indicate danger
                        square.style.fontSize = '24px';
                        square.style.color = 'white';
                        square.style.fontWeight = 'bold';
                        square.style.animation = 'dangerPulse 1s infinite alternate';
                    }
                }
                
                if (socket.id === data.winner) {
                    gameMessage.textContent = 'Congratulations! You are the last player standing!';
                    gameMessage.className = 'message success';
                } else if (socket.id === data.loser) {
                    gameMessage.textContent = 'You hit the danger square! Game over!';
                    gameMessage.className = 'message error';
                } else {
                    gameMessage.textContent = `${data.loserName} was eliminated! ${data.winnerName} wins as the last player standing!`;
                    gameMessage.className = 'message success';
                }
            } else {
                // Someone won by clicking all safe squares
                if (socket.id === data.winner) {
                    gameMessage.textContent = 'Congratulations! You clicked all safe squares!';
                    gameMessage.className = 'message success';
                } else {
                    gameMessage.textContent = `Congratulations to ${data.winnerName} for winning!`;
                    gameMessage.className = 'message success';
                }
            }
            
            // Clear current turn indicator
            currentTurnPlayerId = '';
            currentPlayer.textContent = 'Game Over!';
            
            restartGameBtn.style.display = isHost ? 'block' : 'none';
        });

        socket.on('gameRestarted', () => {
            // Reset game data
            activePlayers = [];
            eliminatedPlayers = [];
            currentTurnPlayerId = '';
            
            showScreen(lobbyScreen);
            gameMessage.textContent = '';
            lobbyMessage.textContent = 'Game restarted. Host can start a new game.';
        });

        // Helper functions
        function updatePlayersList(players) {
            playersUl.innerHTML = '';
            players.forEach(player => {
                const li = document.createElement('li');
                li.textContent = player.name + (player.id === socket.id ? ' (You)' : '');
                if (player.id === socket.id) {
                    li.style.fontWeight = 'bold';
                }
                playersUl.appendChild(li);
            });
        }

        function createBoard(container, size, clickHandler) {
            container.innerHTML = '';
            container.style.gridTemplateColumns = `repeat(${Math.ceil(Math.sqrt(size))}, 1fr)`;
            
            for (let i = 0; i < size; i++) {
                const square = document.createElement('div');
                square.dataset.index = i;
                square.addEventListener('click', function() {
                    container.querySelectorAll('div').forEach(div => div.classList.remove('selected'));
                    this.classList.add('selected');
                    dangerSquareIndex = i;
                });
                container.appendChild(square);
            }
        }

        function createGameBoard(container, size) {
            container.innerHTML = '';
            container.style.gridTemplateColumns = `repeat(${Math.ceil(Math.sqrt(size))}, 1fr)`;
            
            for (let i = 0; i < size; i++) {
                const square = document.createElement('div');
                square.dataset.index = i;
                square.addEventListener('click', handleSquareClick);
                container.appendChild(square);
            }
            
            clickedCount.textContent = `Squares clicked: 0/${size-1}`;
        }

        function handleSquareClick(event) {
            if (currentTurnPlayerId !== socket.id) {
                alert("Wait for your turn!");
                return;
            }
            
            const squareIndex = parseInt(event.target.dataset.index);
            socket.emit('squareClicked', { squareIndex });
            
            // Disable clicking until server confirms next turn
            currentTurnPlayerId = '';
        }

        function handleDangerSquareSelection(event) {
            board.querySelectorAll('div').forEach(div => div.classList.remove('selected'));
            event.target.classList.add('selected');
            dangerSquareIndex = parseInt(event.target.dataset.index);
        }
        
        // Enhanced Players List Update Function
        function updateGamePlayersList(activePlayers, eliminatedPlayers, currentPlayerId, winner = null) {
            gamePlayersList.innerHTML = '';
            
            // Create a combined list with proper ordering
            const allPlayersList = [];
            
            // Add active players
            activePlayers.forEach(playerId => {
                const playerName = allPlayers.find(p => p.id === playerId)?.name || 'Unknown';
                allPlayersList.push({
                    id: playerId,
                    name: playerName,
                    status: 'active',
                    isCurrentTurn: playerId === currentPlayerId
                });
            });
            
            // Add eliminated players (in reverse order - last eliminated first)
            eliminatedPlayers.slice().reverse().forEach(eliminatedPlayer => {
                allPlayersList.push({
                    id: eliminatedPlayer.id,
                    name: eliminatedPlayer.name,
                    status: 'eliminated',
                    eliminationOrder: eliminatedPlayer.eliminationOrder,
                    isCurrentTurn: false
                });
            });
            
            // If there's a winner, mark them
            if (winner) {
                const winnerIndex = allPlayersList.findIndex(p => p.id === winner);
                if (winnerIndex !== -1) {
                    allPlayersList[winnerIndex].status = 'winner';
                }
            }
            
            // Create player items
            allPlayersList.forEach(player => {
                const playerItem = document.createElement('div');
                playerItem.className = 'player-item';
                
                // Add status classes
                if (player.status === 'active') {
                    playerItem.classList.add('active');
                } else if (player.status === 'eliminated') {
                    playerItem.classList.add('eliminated');
                } else if (player.status === 'winner') {
                    playerItem.classList.add('winner');
                }
                
                // Add current turn indicator
                if (player.isCurrentTurn) {
                    playerItem.classList.add('current-turn');
                }
                
                // Create content
                let content = '';
                
                // Turn indicator
                if (player.isCurrentTurn) {
                    content += '<span class="turn-indicator">‚ñ∂</span>';
                }
                
                // Player name
                content += `<span>${player.name}${player.id === socket.id ? ' (You)' : ''}</span>`;
                
                // Status indicator
                let statusText = '';
                if (player.status === 'active') {
                    statusText = 'Active';
                } else if (player.status === 'eliminated') {
                    statusText = `Eliminated #${player.eliminationOrder}`;
                } else if (player.status === 'winner') {
                    statusText = 'Winner! üèÜ';
                }
                
                if (statusText) {
                    content += `<span class="player-status">${statusText}</span>`;
                }
                
                playerItem.innerHTML = content;
                gamePlayersList.appendChild(playerItem);
            });
        }
    </script>
</body>
</html>